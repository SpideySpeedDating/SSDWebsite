<body>
  <h1>Login Page!</h1>

  <a href="#"><button id="back-to-home">Back to Home</button></a>

  <script type="module">
    import {Utils} from "/lib/utils.js";

    const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get("code");
    let options = {
        headers: {
            "Access-Control-Allow-Origin": window.location.origin
        }
    }

    fetch(Utils.apiURL() + "/api/status", options)
        .then(response => {
            console.log(response);
        })
        .catch(error => console.error("Error fetching API:", error));
        
    let authOptions = {
        headers: {
            "Access-Control-Allow-Origin": window.location.origin,
            "Authorization" : code
        }
    }

    fetch(Utils.apiURL() + "/auth", authOptions)
        .then(response => {
            if (!response.ok) {
                alert("Failed to login! Check your code?\n")
            } else {
                response.json().then((data) => {
                    console.log(data["jwt"]);
                    localStorage.setItem("jwt", data["jwt"]);
                })
            }
        })
        .catch(error => console.error("Error fetching API:", error));
    
    if (!Utils.isNullOrUndefined(localStorage.getItem(Utils.loginRedirect))) {
        let htmlId = localStorage.getItem(Utils.loginRedirect);
        localStorage.removeItem(Utils.loginRedirect);
        localStorage.removeItem(Utils.indexMessage);
        window.location.hash = htmlId;
    }
    let backToHome = document.getElementById("back-to-home");
    backToHome.addEventListener('click', () => {
        window.location.hash = "";
    })
</script>

</body>